/*
 everloader
 Author: Jim Cowart (http://freshbrewedcode.com/jimcowart)
 License: Dual licensed MIT (http://www.opensource.org/licenses/mit-license) & GPL (http://www.opensource.org/licenses/gpl-license)
 Version 0.1.0
 */
(function(e,t){"object"==typeof module&&module.exports?module.exports=function(){var n=require("jquery");return t(n,e)}():"function"==typeof define&&define.amd?define(["jquery"],function(n){return t(n,e)}):e.everloader=t(e.$,e)})(this,function(e){var t={apiKey:"",mimeTypes:[],timeout:6e4,getBase64ImageFromInput:function(e,t){var n=new FileReader;n.onloadend=function(e){t&&t(e.target.result)},n.readAsDataURL(e)},getElUri:function(){return"https://api.everlive.com/v1/"+this.apiKey+"/Files"},getFileInputs:function(){return document.querySelectorAll('input[type="file"]')},getImageFileObject:function(e,n){var r=e.name,i=r.substr(r.lastIndexOf(".")+1).toLowerCase();!t.mimeTypes.length||t.mimeTypes.indexOf(e.type)?this.getBase64ImageFromInput(e,function(t){var i={Filename:r,ContentType:e.type,base64:t.substr(t.lastIndexOf("base64,")+7)};n(null,i)}):n("File type not supported: "+i)}},n=function(n,r){t.getImageFileObject(n,function(n,i){return n?(r(n),undefined):(e.ajax({type:"POST",url:t.getElUri(),contentType:"application/json",data:JSON.stringify(i),error:function(e){r(e)}}).done(function(e){r(null,e.Result)}),undefined)})},r=function(e,t,r){for(var i=e.files.length,o=0,u=i,a=e.getAttribute("id"),f=t[a]=t[a]||{},s=function(e,n){return function(i,o){i?(t.errors._count++,t.errors[a]=t.errors[a]||[],t.errors[a].push({filename:n,error:i,originalIndex:e})):(o.originalIndex=e,f[o.Id]=o),u--,u||r()}};i>o;o++)n(e.files[o],s(o,e.files[o].name))};return{configure:function(e){return e?(_.extend(t,e),undefined):t},upload:function(n){var i=t.getFileInputs(),o=i.length,u=o,a=0,f={errors:{_count:0}},s=e.Deferred(function(e){var n=function(){u--,u||(0===f.errors._count?e.resolve(f):e.reject(f))};for(setTimeout(function(){e.reject({error:"The operation timed out.",result:f})},t.timeout);o>a;a++)r(i[a],f,n)}).promise();return n&&s.then(n),s}}});