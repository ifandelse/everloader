/*
 everloader
 Author: Jim Cowart (http://freshbrewedcode.com/jimcowart)
 License: Dual licensed MIT (http://www.opensource.org/licenses/mit-license) & GPL (http://www.opensource.org/licenses/gpl-license)
 Version 0.1.0
 */
(function(e,n){"object"==typeof module&&module.exports?module.exports=function(){var t=require("jquery");return n(t,e)}():"function"==typeof define&&define.amd?define(["jquery"],function(t){return n(t,e)}):e.everloader=n(e.$,e)})(this,function(e){var n={apiKey:"",mimeTypes:{jpg:"image/jpeg",jpeg:"image/jpeg",png:"image/png",gif:"image/gif"},timeout:6e4,getBase64ImageFromInput:function(e,n){var t=new FileReader;t.onloadend=function(e){n&&n(e.target.result)},t.readAsDataURL(e)},getElUri:function(){return"https://api.everlive.com/v1/"+this.apiKey+"/Files"},getFileInputs:function(){return document.querySelectorAll('input[type="file"]')},getImageFileObject:function(e,n){var t=e.name,r=t.substr(t.lastIndexOf(".")+1).toLowerCase(),i=this.mimeTypes[r];i?this.getBase64ImageFromInput(e,function(e){var r={Filename:t,ContentType:i,base64:e.substr(e.lastIndexOf("base64,")+7)};n(null,r)}):n("File type not supported: "+r)}},t=function(t,r){n.getImageFileObject(t,function(t,i){return t?(r(t),undefined):(e.ajax({type:"POST",url:n.getElUri(),contentType:"application/json",data:JSON.stringify(i),error:function(e){r(e)}}).done(function(e){r(null,e.Result)}),undefined)})},r=function(e,n,r){for(var i=e.files.length,o=0,u=i,a=e.getAttribute("id"),f=n[a]=n[a]||{},s=function(e,t){return function(i,o){i?(n.errors._count++,n.errors[a]=n.errors[a]||[],n.errors[a].push({filename:t,error:i,originalIndex:e})):(o.originalIndex=e,f[o.Id]=o),u--,u||r()}};i>o;o++)t(e.files[o],s(o,e.files[o].name))};return{configure:function(e){return e?(_.extend(n,e),undefined):n},upload:function(t){var i=n.getFileInputs(),o=i.length,u=o,a=0,f={errors:{_count:0}},s=e.Deferred(function(e){var t=function(){u--,u||e.resolve(f)};for(setTimeout(function(){e.reject({error:"The operation timed out.",result:f})},n.timeout);o>a;a++)r(i[a],f,t)}).promise();return t&&s.then(t),s}}});